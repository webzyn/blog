<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Proxy | note</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.bd4128e7.css" as="style"><link rel="preload" href="/blog/assets/js/app.b79315a2.js" as="script"><link rel="preload" href="/blog/assets/js/2.e7771c76.js" as="script"><link rel="preload" href="/blog/assets/js/41.1732a1a3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.74a55607.js"><link rel="prefetch" href="/blog/assets/js/11.7d1fedfc.js"><link rel="prefetch" href="/blog/assets/js/12.3466be32.js"><link rel="prefetch" href="/blog/assets/js/13.96a82a9e.js"><link rel="prefetch" href="/blog/assets/js/14.c9ea0587.js"><link rel="prefetch" href="/blog/assets/js/15.63efa028.js"><link rel="prefetch" href="/blog/assets/js/16.688823d9.js"><link rel="prefetch" href="/blog/assets/js/17.a696e384.js"><link rel="prefetch" href="/blog/assets/js/18.8e184181.js"><link rel="prefetch" href="/blog/assets/js/19.ae5a403a.js"><link rel="prefetch" href="/blog/assets/js/20.d35caf44.js"><link rel="prefetch" href="/blog/assets/js/21.f9d70250.js"><link rel="prefetch" href="/blog/assets/js/22.65b73cbc.js"><link rel="prefetch" href="/blog/assets/js/23.a40a256d.js"><link rel="prefetch" href="/blog/assets/js/24.bba1aa17.js"><link rel="prefetch" href="/blog/assets/js/25.f6018f80.js"><link rel="prefetch" href="/blog/assets/js/26.0a3ba188.js"><link rel="prefetch" href="/blog/assets/js/27.28407854.js"><link rel="prefetch" href="/blog/assets/js/28.37acd8e2.js"><link rel="prefetch" href="/blog/assets/js/29.6488aba1.js"><link rel="prefetch" href="/blog/assets/js/3.0a4c0af4.js"><link rel="prefetch" href="/blog/assets/js/30.3d7a5515.js"><link rel="prefetch" href="/blog/assets/js/31.34f844ab.js"><link rel="prefetch" href="/blog/assets/js/32.cad6fba6.js"><link rel="prefetch" href="/blog/assets/js/33.60c00a45.js"><link rel="prefetch" href="/blog/assets/js/34.f7c753dc.js"><link rel="prefetch" href="/blog/assets/js/35.34d45dc8.js"><link rel="prefetch" href="/blog/assets/js/36.4f23bcc6.js"><link rel="prefetch" href="/blog/assets/js/37.5b6b1610.js"><link rel="prefetch" href="/blog/assets/js/38.bdd72f3e.js"><link rel="prefetch" href="/blog/assets/js/39.9206eca4.js"><link rel="prefetch" href="/blog/assets/js/4.5f5152f2.js"><link rel="prefetch" href="/blog/assets/js/40.f5351e42.js"><link rel="prefetch" href="/blog/assets/js/42.50d463db.js"><link rel="prefetch" href="/blog/assets/js/43.2577ee95.js"><link rel="prefetch" href="/blog/assets/js/44.9fb62350.js"><link rel="prefetch" href="/blog/assets/js/45.7aa00c11.js"><link rel="prefetch" href="/blog/assets/js/46.6aab6541.js"><link rel="prefetch" href="/blog/assets/js/47.95664943.js"><link rel="prefetch" href="/blog/assets/js/48.37b94e80.js"><link rel="prefetch" href="/blog/assets/js/49.ae3b751c.js"><link rel="prefetch" href="/blog/assets/js/5.60da61b1.js"><link rel="prefetch" href="/blog/assets/js/50.ed42afe1.js"><link rel="prefetch" href="/blog/assets/js/51.cc5eb15f.js"><link rel="prefetch" href="/blog/assets/js/52.1bb6129d.js"><link rel="prefetch" href="/blog/assets/js/53.0f491a8b.js"><link rel="prefetch" href="/blog/assets/js/54.ba184a64.js"><link rel="prefetch" href="/blog/assets/js/55.ea935fda.js"><link rel="prefetch" href="/blog/assets/js/56.7adce20c.js"><link rel="prefetch" href="/blog/assets/js/57.4eb282ef.js"><link rel="prefetch" href="/blog/assets/js/58.1ec7e059.js"><link rel="prefetch" href="/blog/assets/js/59.05dab633.js"><link rel="prefetch" href="/blog/assets/js/6.510d100b.js"><link rel="prefetch" href="/blog/assets/js/60.e9446db1.js"><link rel="prefetch" href="/blog/assets/js/61.a246ca3d.js"><link rel="prefetch" href="/blog/assets/js/62.0a02fcc6.js"><link rel="prefetch" href="/blog/assets/js/63.39f7465d.js"><link rel="prefetch" href="/blog/assets/js/64.a79633c6.js"><link rel="prefetch" href="/blog/assets/js/65.49022a4e.js"><link rel="prefetch" href="/blog/assets/js/66.7d1975ca.js"><link rel="prefetch" href="/blog/assets/js/67.bdca5e33.js"><link rel="prefetch" href="/blog/assets/js/68.d284c595.js"><link rel="prefetch" href="/blog/assets/js/69.0bb640be.js"><link rel="prefetch" href="/blog/assets/js/7.708b51f6.js"><link rel="prefetch" href="/blog/assets/js/70.19227884.js"><link rel="prefetch" href="/blog/assets/js/71.9762b2b6.js"><link rel="prefetch" href="/blog/assets/js/72.6fe05cb0.js"><link rel="prefetch" href="/blog/assets/js/73.4bee8c6c.js"><link rel="prefetch" href="/blog/assets/js/74.0ddc8281.js"><link rel="prefetch" href="/blog/assets/js/75.41c7348d.js"><link rel="prefetch" href="/blog/assets/js/76.650adb61.js"><link rel="prefetch" href="/blog/assets/js/77.f6448d71.js"><link rel="prefetch" href="/blog/assets/js/78.8cff88c5.js"><link rel="prefetch" href="/blog/assets/js/79.73f599a9.js"><link rel="prefetch" href="/blog/assets/js/8.79cf3428.js"><link rel="prefetch" href="/blog/assets/js/80.9fa5acee.js"><link rel="prefetch" href="/blog/assets/js/81.ae7d04ab.js"><link rel="prefetch" href="/blog/assets/js/82.dedda254.js"><link rel="prefetch" href="/blog/assets/js/9.fb80018e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.bd4128e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/javascript/" class="nav-link router-link-active">
  javascript
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/echarts/" class="nav-link">
  echarts
</a></div><div class="nav-item"><a href="/blog/axios/" class="nav-link">
  axios
</a></div><div class="nav-item"><a href="/blog/uniapp/" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/blog/nodejs/fs.html" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/blog/mysql/mysql.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/blog/markDown/" class="nav-link">
  markDown
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/javascript/" class="nav-link router-link-active">
  javascript
</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">
  css
</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/blog/echarts/" class="nav-link">
  echarts
</a></div><div class="nav-item"><a href="/blog/axios/" class="nav-link">
  axios
</a></div><div class="nav-item"><a href="/blog/uniapp/" class="nav-link">
  uniapp
</a></div><div class="nav-item"><a href="/blog/nodejs/fs.html" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/blog/mysql/mysql.html" class="nav-link">
  MySQL
</a></div><div class="nav-item"><a href="/blog/markDown/" class="nav-link">
  markDown
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link">
  面试
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/basis/array.html" class="sidebar-link">Array对象</a></li><li><a href="/blog/javascript/basis/object.html" class="sidebar-link">Object对象</a></li><li><a href="/blog/javascript/basis/string.html" class="sidebar-link">String对象</a></li><li><a href="/blog/javascript/basis/Math.html" class="sidebar-link">Math对象</a></li><li><a href="/blog/javascript/basis/Date.html" class="sidebar-link">Date对象</a></li><li><a href="/blog/javascript/basis/for.html" class="sidebar-link">四种for循环</a></li><li><a href="/blog/javascript/basis/new.html" class="sidebar-link">new关键字</a></li><li><a href="/blog/javascript/basis/构造函数.html" class="sidebar-link">构造函数</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ES6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/es6/Symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/blog/javascript/es6/set_map.html" class="sidebar-link">set和map</a></li><li><a href="/blog/javascript/es6/set_array_map_object.html" class="sidebar-link">set、array、map和object区别</a></li><li><a href="/blog/javascript/es6/Promise.html" class="sidebar-link">Promise对象</a></li><li><a href="/blog/javascript/es6/Iterator.html" class="sidebar-link">Iterator遍历器</a></li><li><a href="/blog/javascript/es6/for...of.html" class="sidebar-link">for...of循环</a></li><li><a href="/blog/javascript/es6/Generator.html" class="sidebar-link">Generator函数</a></li><li><a href="/blog/javascript/es6/async_await.html" class="sidebar-link">async函数</a></li><li><a href="/blog/javascript/es6/Proxy.html" aria-current="page" class="active sidebar-link">Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/javascript/es6/Proxy.html#基本用法" class="sidebar-link">基本用法</a></li><li class="sidebar-sub-header"><a href="/blog/javascript/es6/Proxy.html#proxy-revocable-返回一个可取消的-proxy-实例" class="sidebar-link">Proxy.revocable() 返回一个可取消的 Proxy 实例</a></li><li class="sidebar-sub-header"><a href="/blog/javascript/es6/Proxy.html#handle-对象上-的方法-13-种" class="sidebar-link">handle 对象上 的方法(13 种)</a></li><li class="sidebar-sub-header"><a href="/blog/javascript/es6/Proxy.html#this" class="sidebar-link">this</a></li></ul></li><li><a href="/blog/javascript/es6/Reflect.html" class="sidebar-link">Reflect</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/javascript/blob.html" class="sidebar-link">Bolb</a></li><li><a href="/blog/javascript/MIME.html" class="sidebar-link">MIME类型</a></li><li><a href="/blog/javascript/fuzzySearch.html" class="sidebar-link">树形结构模糊搜索</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h1> <p></p><div class="table-of-contents"><ul><li><a href="#基本用法">基本用法</a></li><li><a href="#proxy-revocable-返回一个可取消的-proxy-实例">Proxy.revocable() 返回一个可取消的 Proxy 实例</a></li><li><a href="#handle-对象上-的方法-13-种">handle 对象上 的方法(13 种)</a><ul><li><a href="#apply-拦截函数的调用、call-和-apply-操作">apply() 拦截函数的调用、call 和 apply 操作</a></li><li><a href="#construct-拦截-new-命令">construct() 拦截 new 命令</a></li><li><a href="#get-拦截某个属性的读取操作">get() 拦截某个属性的读取操作</a></li><li><a href="#set-拦截某个属性的赋值操作">set() 拦截某个属性的赋值操作</a></li><li><a href="#deleteproperty-拦截-delete-操作">deleteProperty() 拦截 delete 操作</a></li><li><a href="#has-拦截-in-操作符">has() 拦截 in 操作符</a></li><li><a href="#defineproperty-拦截-object-defineproperty-操作">defineProperty() 拦截 Object.defineProperty()操作</a></li><li><a href="#getownpropertydescriptor-拦截-object-getownpropertydescriptor">getOwnPropertyDescriptor() 拦截 Object.getOwnPropertyDescriptor()</a></li><li><a href="#getprototypeof-拦截获取对象原型">getPrototypeOf() 拦截获取对象原型</a></li><li><a href="#setprototypeof-拦截-object-setprototypeof">setPrototypeOf() 拦截 Object.setPrototypeOf()</a></li><li><a href="#preventextensions-拦截-object-preventextensions">preventExtensions() 拦截 Object.preventExtensions()</a></li><li><a href="#isextensible-拦截-object-isextensible">isExtensible() 拦截 Object.isExtensible()</a></li><li><a href="#ownkeys-拦截对象自身属性的读取操作">ownKeys() 拦截对象自身属性的读取操作</a></li></ul></li><li><a href="#this">this</a></li></ul></div><p></p> <h2 id="基本用法"><a href="#基本用法" class="header-anchor">#</a> 基本用法</h2> <p><code>Proxy(代理)</code>: 在目标对象之前架设一层“拦截”，外界对该对象的访问，都必须先通过这层拦截，因此提供了一种机制，可以对外界的访问进行过滤和改写</p> <blockquote><p>var proxy = new Proxy(target, handler);</p></blockquote> <ul><li><code>new Proxy()</code>表示生成一个 Proxy 实例</li> <li><code>target</code> 参数表示所<code>要拦截的目标对象</code></li> <li><code>handler</code> 参数也是一个<code>对象</code>，用来<code>定制拦截行为</code>(键是需要代理的操作，值是处理函数)
<ul><li>对于每一个被代理的操作，需要提供一个对应的处理函数，该函数将拦截对应的操作</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 拦截读取属性</span>
<span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">35</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

proxy<span class="token punctuation">.</span>name <span class="token comment">// 35</span>
proxy<span class="token punctuation">.</span>title <span class="token comment">// 35</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>Proxy 实例可以作为其他对象的<code>原型对象</code></li></ul> <h2 id="proxy-revocable-返回一个可取消的-proxy-实例"><a href="#proxy-revocable-返回一个可取消的-proxy-实例" class="header-anchor">#</a> Proxy.revocable() 返回一个可取消的 Proxy 实例</h2> <blockquote><p>let p = Proxy.revocable(target,handle)</p></blockquote> <ul><li>返回值
<ul><li>返回一个对象
<ul><li>proxy 属性是 Proxy 实例</li> <li>revoke 属性是一个函数，可以取消 Proxy 实例</li></ul></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  handle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> Proxy<span class="token punctuation">.</span><span class="token function">revocable</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">123</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// 123</span>

<span class="token comment">// 取消代理</span>
p<span class="token punctuation">.</span><span class="token function">revoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: Cannot perform 'get' on a proxy that has been revoked</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="handle-对象上-的方法-13-种"><a href="#handle-对象上-的方法-13-种" class="header-anchor">#</a> handle 对象上 的方法(13 种)</h2> <h3 id="apply-拦截函数的调用、call-和-apply-操作"><a href="#apply-拦截函数的调用、call-和-apply-操作" class="header-anchor">#</a> apply() 拦截函数的调用、call 和 apply 操作</h3> <ul><li><code>apply</code> 方法<code>拦截函数的调用</code>、<code>call</code> 和 <code>apply</code> 操作</li></ul> <blockquote><p>apply (target, ctx, args)</p></blockquote> <ul><li>参数
<ul><li>target: <code>目标对象(函数)</code></li> <li>ctx: 目标对象的<code>上下文对象</code>(this)</li> <li>args: 目标对象的<code>参数数组</code></li></ul></li> <li>返回值
<ul><li>返回任意值</li></ul></li> <li>拦截以下操作
<ul><li><code>proxy(...args)</code></li> <li><code>Function.prototype.apply()</code> 和 <code>Function.prototype.call()</code></li> <li><code>Reflect.apply()</code></li></ul></li> <li>约束
<ul><li>target 必须是一个函数对象</li></ul></li> <li>注意：<code>Proxy 实例</code>作为<code>函数调用</code>时，会被 <code>apply()</code>方法拦截</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">target</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;I am the target&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">apply</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;I am the proxy&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;I am the proxy&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="construct-拦截-new-命令"><a href="#construct-拦截-new-命令" class="header-anchor">#</a> construct() 拦截 new 命令</h3> <ul><li>construct()方法用于拦截 new 命令</li></ul> <blockquote><p>construct (target, args, newTarget)</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">construct</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> args<span class="token punctuation">,</span> newTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">target</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>参数:
<ul><li>target: <code>目标对象</code>(必须是函数)</li> <li>args: 构造函数的<code>参数数组</code></li> <li>newTarget(可选): 创造实例对象时，new 命令作用的构造函数</li></ul></li> <li>返回值
<ul><li>construct()方法返回的必须是一个<code>对象</code></li></ul></li> <li>拦截以下操作
<ul><li><code>new proxy(...args)</code></li> <li><code>Reflect.construct()</code></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">construct</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">P</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token comment">// {value: 10}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="get-拦截某个属性的读取操作"><a href="#get-拦截某个属性的读取操作" class="header-anchor">#</a> get() 拦截某个属性的读取操作</h3> <ul><li>get 方法用于拦截对象某个属性的读取操作</li></ul> <blockquote><p>get(target, propKey, receiver)</p></blockquote> <ul><li><p>参数</p> <ul><li>target: <code>目标对象</code></li> <li>propKey: <code>属性名</code></li> <li>receiver(可选): <code>Proxy实例</code> 或者<code>继承 Proxy 的对象</code></li></ul></li> <li><p>返回值</p> <ul><li>任意值</li></ul></li> <li><p>拦截以下操作</p> <ul><li>访问属性：<code>proxy[foo]</code> 和 <code>proxy.bar</code></li> <li>访问原型链上的属性：<code>Object.create(proxy)[foo]</code></li> <li><code>Reflect.get()</code></li></ul></li> <li><p>约束</p> <ul><li>如果一个属性<code>不可配置</code>（configurable）且<code>不可写</code>（writable），则<code>handle.get</code>返回值必须与目标属性值相同(不能修改值)</li> <li>如果要访问的目标属性没有配置访问方法，即 get 方法是 undefined 的，则返回值必须为 undefined</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>propKey <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 对象中存在某属性 取出属性值</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 对象中不存在属性 抛出异常</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">目标对象不存在属性</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>propKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span>name <span class="token comment">// '张三'</span>
proxy<span class="token punctuation">.</span>age <span class="token comment">// Uncaught Error: 目标对象不存在属性age</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> receiver
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span>name <span class="token operator">===</span> proxy <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="get-方法可以继承"><a href="#get-方法可以继承" class="header-anchor">#</a> get 方法可以继承</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">&quot;我是foo&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> propertyKey<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>propertyKey<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token comment">// 将proxy设为obj的原型对象</span>
obj<span class="token punctuation">.</span>foo <span class="token comment">// '我是foo'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="如果一个属性不可配置-configurable-且不可写-writable-则-proxy-不能修改该属性-否则通过-proxy-对象访问该属性会报错"><a href="#如果一个属性不可配置-configurable-且不可写-writable-则-proxy-不能修改该属性-否则通过-proxy-对象访问该属性会报错" class="header-anchor">#</a> 如果一个属性不可配置（configurable）且不可写（writable），则 Proxy 不能修改该属性，否则通过 Proxy 对象访问该属性会报错</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
      <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> propKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;abc&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>

proxy<span class="token punctuation">.</span>foo
<span class="token comment">// Uncaught TypeError: 'get' on proxy: property 'foo' is a read-only and non-configurable data property on the proxy target but the proxy did not return its actual value (expected '123' but got 'abc')</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="set-拦截某个属性的赋值操作"><a href="#set-拦截某个属性的赋值操作" class="header-anchor">#</a> set() 拦截某个属性的赋值操作</h3> <ul><li>set 方法用来拦截某个属性的赋值操作</li></ul> <blockquote><p>set(target, propKey, value, receiver)</p></blockquote> <ul><li><p>参数</p> <ul><li>target: <code>目标对象</code></li> <li>propKey: <code>属性名</code></li> <li>value: <code>属性值</code></li> <li>receiver(可选): <code>proxy 实例本身</code></li></ul></li> <li><p>返回值</p> <ul><li>返回 true 代表属性设置成功</li></ul></li> <li><p>拦截以下操作</p> <ul><li>指定属性值：<code>proxy[foo] = bar</code> 和 <code>proxy.foo = bar</code></li> <li>指定继承者的属性值：<code>Object.create(proxy)[foo] = bar</code></li> <li><code>Reflect.set()</code></li></ul></li> <li><p>约束</p> <ul><li>如果目标属性<code>不可写</code>、<code>不可配置</code>，不能设置它的值。</li> <li>严格模式下，<code>set()</code>如果返回 <code>false</code>，会抛出异常</li> <li>如果目标属性没有配置存储方法，即 defineProperty 的 set 方法是 undefined 的，不能设置它的值。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> setMinValue <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> setMinValue<span class="token punctuation">)</span>
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">100</span>
person<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token number">500</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 200</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token comment">// 500</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>示例：禁止内部属性被访问</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">私有</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性的尝试失效</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;获取&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;设置&quot;</span><span class="token punctuation">)</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> handle<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>_prop<span class="token punctuation">)</span> <span class="token comment">// Uncaught Error: 获取私有_prop属性的尝试失效</span>
proxy<span class="token punctuation">.</span>_prop <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token comment">// VM4975:3 Uncaught Error: 设置私有_prop属性的尝试失效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="如果目标对象自身的某个属性不可写-writable-那么-set-方法将不起作用"><a href="#如果目标对象自身的某个属性不可写-writable-那么-set-方法将不起作用" class="header-anchor">#</a> 如果目标对象自身的某个属性不可写（writable），那么 set 方法将不起作用</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 设置foo属性不可写</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// &quot;bar&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="deleteproperty-拦截-delete-操作"><a href="#deleteproperty-拦截-delete-操作" class="header-anchor">#</a> deleteProperty() 拦截 delete 操作</h3> <ul><li><code>deleteProperty</code> 方法用于拦截 <code>delete</code> 操作，如果这个方法<code>抛出错误</code>或者返回 <code>false</code>，当前属性就无法被 delete 命令删除</li></ul> <blockquote><p>deleteProperty(target, propKey)</p></blockquote> <ul><li><p>参数</p> <ul><li>target: <code>目标对象</code></li> <li>propKey: 待删除的<code>属性名</code></li></ul></li> <li><p>返回值</p> <ul><li>必须返回一个 Boolean 类型的值，表示了该属性是否被成功删除。</li></ul></li> <li><p>拦截以下操作</p> <ul><li>删除属性：<code>delete proxy[foo]</code> 和 <code>delete proxy.foo</code></li> <li><code>Reflect.deleteProperty()</code></li></ul></li> <li><p>约束</p> <ul><li>目标对象自身的<code>不可配置</code>（configurable）的属性，不能被 deleteProperty 方法删除</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">私有</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性的尝试无效</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">invariant</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;删除&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">delete</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">_prop</span><span class="token operator">:</span> <span class="token string">&quot;_prop&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token string">&quot;prop&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token keyword">delete</span> proxy<span class="token punctuation">.</span>_prop <span class="token comment">// Uncaught Error: 删除私有_prop属性的尝试无效</span>
<span class="token keyword">delete</span> proxy<span class="token punctuation">.</span>prop <span class="token comment">// true</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token comment">// Proxy(Object) {_prop: '_prop'}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment">// {_prop: '_prop'}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="has-拦截-in-操作符"><a href="#has-拦截-in-操作符" class="header-anchor">#</a> has() 拦截 in 操作符</h3> <ul><li>has()方法用来拦截 <code>HasProperty</code> 操作，即<code>判断对象是否具有某个属性</code>时，这个方法会生效。典型的操作就是<code>in运算符</code>。</li></ul> <blockquote><p>has(target,propKey)</p></blockquote> <ul><li>参数
<ul><li>target: <code>目标对象</code></li> <li>propKey: <code>需查询的属性名</code></li></ul></li> <li>返回值
<ul><li>返回一个 boolean 属性的值。</li></ul></li> <li>拦截以下操作
<ul><li>属性查询：<code>foo in proxy</code></li> <li>继承属性查询：<code>foo in Object.create(proxy)</code></li> <li>with 检查: <code>with(proxy) { (foo); }</code></li> <li><code>Reflect.has()</code></li></ul></li> <li>约束
<ul><li>如果目标属性<code>不可配置(configurable)</code>，该属性不能够被代理隐藏</li> <li>如果目标属性<code>禁止扩展(Object.preventExtensions)</code>，该属性不能够被代理隐藏</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">_prop</span><span class="token operator">:</span> <span class="token string">&quot;_prop&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token string">&quot;prop&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">has</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// 原对象属性名第一个字符是下划线，返回false，从而不会被in运算符发现</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> key <span class="token keyword">in</span> target
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>

<span class="token string">&quot;_prop&quot;</span> <span class="token keyword">in</span> proxy <span class="token comment">// false</span>
<span class="token string">&quot;prop&quot;</span> <span class="token keyword">in</span> proxy <span class="token comment">// true</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// _prop prop</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="原对象不可配置-configurable-或者禁止扩展-object-preventextensions-时-has-拦截会报错"><a href="#原对象不可配置-configurable-或者禁止扩展-object-preventextensions-时-has-拦截会报错" class="header-anchor">#</a> 原对象不可配置(configurable)或者禁止扩展(Object.preventExtensions)，时 has()拦截会报错</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">has</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token string">&quot;a&quot;</span> <span class="token keyword">in</span> p <span class="token comment">// Uncaught TypeError: 'has' on proxy: trap returned falsish for property 'a' but the proxy target is not extensible</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="defineproperty-拦截-object-defineproperty-操作"><a href="#defineproperty-拦截-object-defineproperty-操作" class="header-anchor">#</a> defineProperty() 拦截 Object.defineProperty()操作</h3> <ul><li>defineProperty()方法拦截了 Object.defineProperty()操作</li></ul> <blockquote><p>defineProperty (target, propKey, descriptor)</p></blockquote> <ul><li>参数:
<ul><li>target: <code>目标对象</code></li> <li>propKey: <code>属性名</code></li> <li>descriptor: 这个属性的<code>描述对象</code></li></ul></li> <li>返回值
<ul><li>必须以一个 <code>Boolean</code> 返回，表示定义该属性的操作成功与否</li></ul></li> <li>会拦截以下操作
<ul><li><code>Object.defineProperty()</code> 设置属性描述符</li> <li><code>Reflect.defineProperty()</code></li> <li><code>proxy.property = 'value'</code></li></ul></li> <li>约束
<ul><li>如果目标对象<code>不可扩展</code>，将<code>不能</code>添加属性</li> <li>如果目标对象属性<code>不可配置</code>,<code>不能</code>添加或者修改属性</li> <li>在严格模式下，false 作为 handler.defineProperty 方法的返回值的话将会抛出异常</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> desc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> desc<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">&quot;foo&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;foo&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Proxy(Object) {foo: 'foo'}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;aaa&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Proxy(Object) {foo: 'foo', aaa: 'bar'}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="getownpropertydescriptor-拦截-object-getownpropertydescriptor"><a href="#getownpropertydescriptor-拦截-object-getownpropertydescriptor" class="header-anchor">#</a> getOwnPropertyDescriptor() 拦截 Object.getOwnPropertyDescriptor()</h3> <ul><li>getOwnPropertyDescriptor()方法拦截 Object.getOwnPropertyDescriptor()</li></ul> <blockquote><p>getOwnPropertyDescriptor (target, prop)</p></blockquote> <ul><li>参数:
<ul><li>target: <code>目标对象</code></li> <li>prop: <code>属性名</code></li></ul></li> <li>返回值
<ul><li>返回一个<code>属性描述对象</code> 或者 <code>undefined</code></li></ul></li> <li>可以拦截的操作
<ul><li><code>Object.getOwnPropertyDescriptor()</code> 获取属性描述符</li> <li><code>Reflect.getOwnPropertyDescriptor()</code></li></ul></li> <li>约束
<ul><li>handle.getOwnPropertyDescriptor 必须返回一个 <code>object</code> 或 undefined</li> <li>如果目标属性为不可配置，则该属性无法报告为不存在</li> <li>如果目标对象存在，且不可扩展，则该属性无法报告为不存在</li> <li>如果目标属性不存在，且不可扩展，则不能将其报告为存在</li> <li>如果为目标属性不存在，或者目标属性不可配置，属性不能被报告为不可配置</li> <li>Object.getOwnPropertyDescriptor（target）的结果可以使用 Object.defineProperty 应用于目标对象，也不会抛出异常</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">_foo</span><span class="token operator">:</span> <span class="token string">&quot;_foo&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>

Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">&quot;_foo&quot;</span><span class="token punctuation">)</span> <span class="token comment">// undefined =&gt; proxy 拦截</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// {value: 'bar', writable: true, enumerable: true, configurable: true}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="getprototypeof-拦截获取对象原型"><a href="#getprototypeof-拦截获取对象原型" class="header-anchor">#</a> getPrototypeOf() 拦截获取对象原型</h3> <ul><li>getPrototypeOf()方法主要用来拦截获取对象原型</li></ul> <blockquote><p>getPrototypeOf(target)</p></blockquote> <ul><li>参数:
<ul><li>target: <code>目标对象</code></li></ul></li> <li>返回值
<ul><li>返回<code>一个对象</code>或者<code>null</code></li></ul></li> <li>可以拦截的操作
<ul><li><code>Object.getPrototypeOf()</code></li> <li><code>Reflect.getPrototypeOf()</code></li> <li><code>Object.prototype.__proto__</code></li> <li><code>Object.prototype.isPrototypeOf()</code></li> <li><code>instanceof</code></li></ul></li> <li>约束
<ul><li>handle.getPrototypeOf() 方法<code>必须</code>返回<code>对象</code>或者<code>null</code></li> <li>如果目标对象是<code>不可扩展</code>的， 该方法返回的原型必须是<code>目标对象本身的原型</code></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> proto <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> proto
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">// {a: 1}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> pro <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;z&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>pro<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 创建新对象，并把pro设为obj的原型对象</span>

Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// 将obj设为不可扩展</span>
Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// false =&gt; 不可扩展</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return { a: 1 } =&gt; 报错</span>
    <span class="token keyword">return</span> pro
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">// {z: 'z'}</span>
Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// {z: 'z'}</span>

Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">===</span> pro <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="setprototypeof-拦截-object-setprototypeof"><a href="#setprototypeof-拦截-object-setprototypeof" class="header-anchor">#</a> setPrototypeOf() 拦截 Object.setPrototypeOf()</h3> <blockquote><p>setPrototypeOf (target, proto){}</p></blockquote> <ul><li>参数
<ul><li>target： 被拦截<code>目标对象</code></li> <li>prototype： <code>对象新原型</code>或<code>null</code></li></ul></li> <li>返回值
<ul><li>返回一个 <code>Boolean</code> 值或<code>可转换成 Boolean 的值</code></li></ul></li> <li>可以拦截的操作
<ul><li><code>Object.setPrototypeOf()</code></li> <li><code>Reflect.setPrototypeOf()</code></li></ul></li> <li>约束
<ul><li>如果目标对象是<code>不可扩展</code>的， 原型<code>参数</code>必须与 <code>Object.getPrototypeOf(target)</code> 的值相同</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 不为对象设置一个新的原型</span>
<span class="token comment">// handler 的 setPrototypeOf 方法 抛出异常</span>
<span class="token keyword">var</span> newProto <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;不能修改原型对象&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> newProto<span class="token punctuation">)</span> <span class="token comment">// Uncaught Error: 不能修改原型对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="preventextensions-拦截-object-preventextensions"><a href="#preventextensions-拦截-object-preventextensions" class="header-anchor">#</a> preventExtensions() 拦截 Object.preventExtensions()</h3> <ul><li>handler.preventExtensions() 拦截 Object.preventExtensions()返回一个布尔值</li></ul> <blockquote><p>preventExtensions: function(target) {}</p></blockquote> <ul><li>参数
<ul><li>target: <code>目标对象</code></li></ul></li> <li>返回值
<ul><li>返回一个 <code>Boolean</code> 值或<code>可转换成 Boolean 的值</code></li></ul></li> <li>可以拦截的操作
<ul><li><code>Object.preventExtensions()</code> 阻止对象扩展</li> <li><code>Reflect.preventExtensions()</code></li></ul></li> <li>约束条件(强限制)
<ul><li>如果目标对象是可扩展的，那么只能变为不可扩展</li> <li>只有<code>目标对象不可扩展</code>时（即 Object.isExtensible(proxy)为 false），<code>proxy.preventExtensions 才能返回 true</code></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 对象默认是可扩展的</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">preventExtensions</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---拦截Object.preventExtensions()方法---&quot;</span><span class="token punctuation">)</span>
    Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment">// 将目标对象不可扩展 =&gt; 重要</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
<span class="token comment">// ---拦截Object.preventExtensions()方法---</span>
<span class="token comment">// Proxy(Object) {a: 1}</span>

Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// false</span>
Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="isextensible-拦截-object-isextensible"><a href="#isextensible-拦截-object-isextensible" class="header-anchor">#</a> isExtensible() 拦截 Object.isExtensible()</h3> <ul><li>isExtensible()方法拦截 Object.isExtensible()操作</li></ul> <blockquote><p>isExtensible(target){}</p></blockquote> <ul><li>参数
<ul><li>target: <code>目标对象</code></li></ul></li> <li>返回值
<ul><li>必须返回一个 <code>Boolean</code> 值或<code>可转换成 Boolean 的值</code></li></ul></li> <li>可以拦截的操作
<ul><li><code>Object.isExtensible()</code> 判断对象是否可扩展</li> <li><code>Reflect.isExtensible()</code></li></ul></li> <li>约束
<ul><li><code>Object.isExtensible(proxy)</code> 必须同 <code>Object.isExtensible(target)</code> 返回相同值</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span> <span class="token punctuation">}</span>
<span class="token comment">// 将对象obj设为不可扩展</span>
Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">isExtensible</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token comment">// 报错 =&gt; 不满足强限制</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">isExtensible</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;---拦截Object.isExtensible()---&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token comment">// ---拦截Object.isExtensible()---</span>
<span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="ownkeys-拦截对象自身属性的读取操作"><a href="#ownkeys-拦截对象自身属性的读取操作" class="header-anchor">#</a> ownKeys() 拦截对象自身属性的读取操作</h3> <ul><li>ownKeys()方法用来拦截对象自身属性的读取操作</li></ul> <blockquote><p>ownKeys(target)</p></blockquote> <ul><li><p>参数</p> <ul><li>target: <code>目标对象</code></li></ul></li> <li><p>返回值</p> <ul><li>必须返回一个<code>可枚举对象</code></li></ul></li> <li><p>可以拦截以下操作</p> <ul><li><code>for...in 循环</code></li> <li><code>Object.getOwnPropertyNames()</code><br>
获取对象的所有自身属性的属性名(包括不可枚举属性,不包括 Symbol 键名属性)</li> <li><code>Object.getOwnPropertySymbols()</code> 获取对象自身所有的 Symbol 键名的属性</li> <li><code>Object.keys()</code> 返回可枚举属性的 key 组成的数组</li> <li><code>Reflect.ownKeys()</code></li></ul></li> <li><p>约束</p> <ul><li>handle.ownKeys 的结果必须是一个<code>数组</code></li> <li>数组的<code>元素类型</code>必须是一个 <code>String</code> 或者 <code>Symbol</code></li> <li>数组必须包含<code>目标对象</code>的<code>不可配置的 key</code>、<code>自有属性的 key</code></li> <li>如果目标对象<code>不可扩展</code>，那么必须包含目标对象的<code>所有自有（own）属性的 key</code>，<code>不能有其他值</code></li></ul></li></ul> <h4 id="拦截-for-in-循环"><a href="#拦截-for-in-循环" class="header-anchor">#</a> 拦截 for...in 循环</h4> <ul><li>会被过滤的属性
<ul><li>目标对象上不存在的属性</li> <li>属性名为 Symbol 值</li> <li>不可遍历（enumerable）的属性</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>

<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">ownKeys</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 进行拦截</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> p1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token comment">// 没有任何输出  =&gt; 因为ownkeys()指定只返回b和c属性，但是目标对象没有这两个属性</span>

<span class="token comment">// 未拦截</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token comment">// &quot;a&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="拦截-object-keys"><a href="#拦截-object-keys" class="header-anchor">#</a> 拦截 Object.keys()</h4> <ul><li>会被过滤的属性
<ul><li>目标对象上不存在的属性</li> <li>属性名为 Symbol 值</li> <li>不可遍历（enumerable）的属性</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">ownKeys</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 进行拦截</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// ['a']</span>

<span class="token comment">// 不拦截</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c']</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="拦截-object-getownpropertynames"><a href="#拦截-object-getownpropertynames" class="header-anchor">#</a> 拦截 Object.getOwnPropertyNames()</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">ownKeys</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 拦截</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c']</span>

<span class="token comment">// 未拦截</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// []</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="this"><a href="#this" class="header-anchor">#</a> this</h2> <ul><li>在 Proxy 代理的情况下，<code>目标对象</code>内部的 this 关键字会指向 <code>Proxy 代理</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">m</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
target<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// {m: ƒ} =&gt; 指向target对象</span>

<span class="token keyword">const</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
proxy<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Proxy(Object) {m: ƒ} =&gt; 指向 Proxy对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Proxy <code>拦截函数</code>内部的 this，指向的是 <code>handler 对象</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> handler<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> key
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>

proxy<span class="token punctuation">.</span>foo
<span class="token comment">// true</span>
<span class="token comment">// Hello, foo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">前往 MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/javascript/es6/async_await.html" class="prev">
        async函数
      </a></span> <span class="next"><a href="/blog/javascript/es6/Reflect.html">
        Reflect
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.b79315a2.js" defer></script><script src="/blog/assets/js/2.e7771c76.js" defer></script><script src="/blog/assets/js/41.1732a1a3.js" defer></script>
  </body>
</html>
