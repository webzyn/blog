(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{355:function(s,t,a){"use strict";a.r(t);var n=a(13),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"api-promise-化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api-promise-化"}},[s._v("#")]),s._v(" API Promise 化")]),s._v(" "),t("p",[s._v("默认情况下，小程序官方提供的"),t("span",{staticStyle:{color:"red"}},[s._v("异步 API")]),s._v(" 都是"),t("span",{staticStyle:{color:"red"}},[s._v("基于回调函数")]),s._v("实现的。")]),s._v(" "),t("p",[s._v("缺点: 容易造成"),t("span",{staticStyle:{color:"red"}},[s._v("回调地狱")]),s._v("的问题，代码的"),t("span",{staticStyle:{color:"red"}},[s._v("可读性、维护性")]),s._v("差!")]),s._v(" "),t("h2",{attrs:{id:"_1-什么是-api-promise-化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是-api-promise-化"}},[s._v("#")]),s._v(" 1.什么是 API Promise 化")]),s._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[s._v("APl Promise 化")]),s._v("，指的是"),t("span",{staticStyle:{color:"red"}},[s._v("通过额外的配置")]),s._v("，将官方提供的、基于回调函数的异步 API，"),t("span",{staticStyle:{color:"red"}},[s._v("升级改造为基于 Promise 的异步 API")]),s._v("，从而提高代码的可读性、维护性，避免回调地狱的问题。")]),s._v(" "),t("h2",{attrs:{id:"_2-实现-api-promise-化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现-api-promise-化"}},[s._v("#")]),s._v(" 2.实现 API Promise 化")]),s._v(" "),t("p",[s._v("在小程序中，实现 APl Promise 化主要依赖于 "),t("span",{staticStyle:{color:"red"}},[s._v("miniprogram-api-promise")]),s._v(" 这个第三方的 npm 包。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/weixin_52203618/article/details/127151519",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/weixin_52203618/article/details/127151519"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[s._v("① 初始化仓库\n"),t("ul",[t("li",[s._v("在项目空白处右键，点击"),t("code",[s._v("在外部终端窗口中打开")]),s._v(",执行 "),t("code",[s._v("npm init -y")])])])]),s._v(" "),t("li",[s._v("② 安装 npm 包\n"),t("ul",[t("li",[s._v("执行 "),t("code",[s._v("npm install --save miniprogram-api-promise@1.0.4")])])])]),s._v(" "),t("li",[s._v("③ 删除 miniprogram_npm 文件夹")]),s._v(" "),t("li",[s._v("④ 构建 npm\n"),t("ul",[t("li",[s._v("左上角工具，构建 npm")])])])]),s._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[s._v("每次装包 ,都需要删除 miniprogram_npm 文件夹并重新构建 npm")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//在小程序入口文件中(app.js)，只需调用一次 promisifyAll()方法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//即可实现异步API的 Promise 化")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" promisifyAll "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"miniprogram-api-promise"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" wxp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// promisify all wx's api")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("promisifyAll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wxp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("App")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// pages/home/home.js")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Page")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" wx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("method")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://applet-base-api-t.itheima.net/api/get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);